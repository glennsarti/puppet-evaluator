Examples('when declaring Resources in YAML',
  Example('types and instances can be declared in YAML',
    Given(@(SRC)),
      create_resource_types(parse_yaml(@(YAML)))
        MyRes:
          ensure: 'Enum[absent,present]'
          mode: 'Integer[0, 07777]'
        |YAML

      parse_yaml(@(YAML)).each |$k, $v| { create_resources($k, $v) }
        myres:
          '/a/b':
            ensure: absent
          '/a/c':
            ensure: present
          '_defaults':
            mode: 0700
        |YAML

      String([resource('myres[/a/b]'), resource('myres[/a/c]')])
      |-SRC
    Evaluates_to(`[MyRes('title' => '/a/b', 'ensure' => 'absent', 'mode' => 448), MyRes('title' => '/a/c', 'ensure' => 'present', 'mode' => 448)]`)),
)

Examples('when using the YAML Puppet parser',
  Example('resources are instantiated',
    Given(@(SRC)),
      create_resource_types(parse_yaml(@(YAML)))
        MyRes:
          ensure: 'Enum[absent,present]'
          mode: 'Integer[0, 07777]'
        |YAML

      evaluate_yaml('/test/file.yaml', Binary(@(YAML), '%s')) ->
        sequence:
          - resources:
              myres:
                '/a/b':
                  ensure: absent
                  mode: 0700
          - resources:
              myres:
                '/a/c':
                  ensure: "${pnr['myres[/a/b]'].value.ensure}"
                  mode: 0600
        |YAML
      String([resource('my::a[/a/b]')])
      |SRC
    Evaluates_to(`[MyRes('title' => '/a/b', 'ensure' => 'absent', 'mode' => 448), MyRes('title' => '/a/c', 'ensure' => 'absent', 'mode' => 384)]`)),

)
